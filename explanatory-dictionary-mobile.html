<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explanatory Dictionary</title>
    <link rel="stylesheet" href="style-mobile.css">
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/helvetica-neue-5" rel="stylesheet">
</head>

<body>
    <header>
        <select id="nav-select" class="nav-select">
            <option value="" selected disabled hidden>Menu</option>
            <option value="index-mobile.html">Main Page</option>
            <option value="dictionaries-mobile.html">Dictionaries</option>
            <option value="grammar-mobile.html">Grammar</option>
            <option value="transliteration-tool-mobile.html">Transliteration tool</option>
            <option value="about-the-spelling-mobile.html">About the spelling</option>
            <option value="sources-mobile.html">Sources</option>
            <option value="other-mobile.html">Other</option>
            <option value="mailto:aleksanterinazarenko@outlook.com">Contact</option>
        </select>
    </header>

    <main>
        <h1><a href="/learnerzya/index.html">Learn Erzya</a></h1>
        <h2 style="margin: 0 0 30px 0;">Explanatory dictionary</h2>

        <div class="container">
            <select id="languageSelector">
                <option value="cyrillic">Cyrillic</option>
                <option value="latin">Latin</option>
            </select>
            <input id="searchInput" placeholder="Search for a word ..." type="search" autocomplete="off">
            <div id="suggestions" class="suggestions-list" style="display: none;"></div>

            <p style="font-size: 16px; font-style: normal; margin: 0 0 20px 20px; padding: 0;">
                Source: Абрамов, К. Г. <a
                    href="https://books.google.pl/books/about/%D0%92%D0%B0%D0%BB%D0%BE%D0%BD%D1%8C_%D1%91%D0%B2%D1%82%D0%BD%D0%B5%D0%BC%D0%B0_%D0%B2%D0%B0%D0%BB%D0%BA%D1%81.html?id=T18LAQAAMAAJ&redir_esc=y"
                    style="text-decoration: none;">Валонь ёвтнема валкс</a>. — Саранск: Мордовской книжной
                издательствась, 2002
            </p>

            <div id="wordDetails" class="word-details"></div>
        </div>

    </main>

    <footer>
        <a href="mailto:aleksanterinazarenko@outlook.com" style="color: white; text-decoration: none;">&copy; 2024
            Aleksanteri Nazarenko</a>
    </footer>

    <style>
        .nav-select {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            background-color: #333;
            color: #fff;
            cursor: pointer;
        }

        .nav-select option {
            padding: 10px;
            background-color: #333;
            color: #fff;
        }

        .entry {
            color: #333;
            font-size: 16px;
            font-style: normal;
            line-height: 1.5;
            padding: 0;
            margin: 0 20px;
            text-align: left;
        }

        .entry:not(:last-child) {
            margin-bottom: 10px;
        }

        .dictionary-content {
            margin-bottom: 20px;
        }

        .word-details {
            font-size: 16px;
            padding: 10px 0 0 0;
        }

        #wordDetails p {
            margin-bottom: 20px;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const latinJsonURL =
                'https://raw.githubusercontent.com/aleksanterinazarenko/learnerzya/refs/heads/main/databases/explanatory-myv-lat.json';
            const cyrillicJsonURL =
                'https://raw.githubusercontent.com/aleksanterinazarenko/learnerzya/refs/heads/main/databases/explanatory-myv-cyr.json';

            const searchInput = document.getElementById('searchInput');
            const languageSelector = document.getElementById('languageSelector');
            const suggestions = document.getElementById('suggestions');
            const wordDetails = document.getElementById('wordDetails');

            let currentData = [];
            let selectedSuggestionIndex = -1;
            let filteredWords = [];
            let isMouseOverSuggestion = false;

            function showWordDetails(entry) {
                const categoryDisplay = entry.Category ?
                    `<span style="font-weight: normal;">${entry.Category}</span>` : '';

                let definitionHTML = '';

                if (entry.Definition.includes('<div class="entry">')) {
                    definitionHTML = `
            <p style="color: #B22222;">${entry.Word} ${categoryDisplay}</p>
            <div class="dictionary-content">
                ${entry.Definition}
            </div>
        `;
                } else {
                    definitionHTML = `
            <p style="color: #B22222;">${entry.Word} ${categoryDisplay}</p>
            <div class="dictionary-content">
                <div class="entry">${entry.Definition}</div>
            </div>
        `;
                }

                wordDetails.innerHTML = definitionHTML;
                wordDetails.style.display = 'block';
                suggestions.style.display = 'none';

                const baseURL = window.location.origin + window.location.pathname;
                const newURL = `${baseURL}?word=${encodeURIComponent(entry.Word)}`;
                window.history.pushState({
                    word: entry.Word
                }, '', newURL);
            }

            function loadWordFromURL() {
                const urlParams = new URLSearchParams(window.location.search);
                const wordFromURL = urlParams.get('word');

                if (wordFromURL) {
                    const entry = currentData.find(e => e.Word.toLowerCase() === wordFromURL.toLowerCase());
                    if (entry) {
                        showWordDetails(entry);
                        searchInput.value = entry.Word;
                    }
                }
            }

            function loadDictionary(url, callback) {
                fetch(url)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        currentData = [];
                        let lastEntry = null;

                        data.forEach(entry => {
                            if (entry.Word) {
                                if (lastEntry && lastEntry.Definition) {
                                    currentData.push(lastEntry);
                                }

                                lastEntry = {
                                    Word: entry.Word,
                                    Definition: entry.Definition ?
                                        `<div class="entry">${entry.Definition}</div>` : '',
                                    Category: entry.Category
                                };
                            } else if (lastEntry) {
                                if (entry.Definition) {
                                    lastEntry.Definition +=
                                        `<div class="entry">${entry.Definition}</div>`;
                                }
                            }
                        });

                        if (lastEntry) {
                            currentData.push(lastEntry);
                        }

                        suggestions.innerHTML = '';

                        if (callback) callback();
                    })
                    .catch(error => console.error('Error loading the dictionary:', error));
            }

            window.addEventListener('popstate', (event) => {
                if (event.state && event.state.word) {
                    searchInput.value = event.state.word;
                    const foundEntry = currentData.find(entry =>
                        entry.Word.toLowerCase() === event.state.word.toLowerCase()
                    );
                    if (foundEntry) {
                        showWordDetails(foundEntry);
                    }
                } else {
                    searchInput.value = '';
                    wordDetails.innerHTML = '';
                    wordDetails.style.display = 'none';
                }
            });

            function highlightSuggestion(index) {
                const suggestionItems = Array.from(suggestions.getElementsByClassName('suggestion-item'));
                suggestionItems.forEach((item, idx) => {
                    item.classList.toggle('highlight', idx === index);
                });
            }

            searchInput.addEventListener('input', (event) => {
                const query = event.target.value.toLowerCase();
                suggestions.innerHTML = '';
                selectedSuggestionIndex = -1;

                if (query === "") {
                    wordDetails.innerHTML = '';
                    wordDetails.style.display = 'none';
                    suggestions.style.display = 'none';
                } else {
                    wordDetails.style.display = 'none';
                    filteredWords = currentData
                        .filter(entry => entry.Word.toLowerCase().includes(query))
                        .sort((a, b) => {
                            const aStartsWith = a.Word.toLowerCase().startsWith(query);
                            const bStartsWith = b.Word.toLowerCase().startsWith(query);

                            if (aStartsWith && !bStartsWith) return -1;
                            if (!aStartsWith && bStartsWith) return 1;

                            return a.Word.length - b.Word.length;
                        })
                        .slice(0, 10);

                    if (filteredWords.length > 0) {
                        filteredWords.forEach((entry, index) => {
                            const suggestionItem = document.createElement('div');
                            suggestionItem.className = 'suggestion-item';
                            suggestionItem.textContent = entry.Word;

                            suggestionItem.onclick = () => {
                                selectedSuggestionIndex = index;
                                highlightSuggestion(selectedSuggestionIndex);
                                searchInput.value = entry.Word;
                                showWordDetails(entry);
                                suggestions.style.display = 'none';
                            };

                            suggestionItem.onmouseover = () => {
                                isMouseOverSuggestion = true;
                                selectedSuggestionIndex = index;
                                highlightSuggestion(selectedSuggestionIndex);
                            };

                            suggestionItem.onmouseout = () => {
                                isMouseOverSuggestion = false;
                            };

                            suggestions.appendChild(suggestionItem);
                        });
                        suggestions.style.display = 'block';
                    } else {
                        suggestions.style.display = 'none';
                    }
                }
            });

            searchInput.addEventListener('keydown', (event) => {
                const suggestionItems = Array.from(suggestions.getElementsByClassName(
                    'suggestion-item'));

                if (!isMouseOverSuggestion) {
                    if (event.key === 'ArrowDown') {
                        if (selectedSuggestionIndex < suggestionItems.length - 1) {
                            selectedSuggestionIndex++;
                            highlightSuggestion(selectedSuggestionIndex);
                            suggestionItems[selectedSuggestionIndex].scrollIntoView({
                                block: 'nearest'
                            });
                        }
                    } else if (event.key === 'ArrowUp') {
                        if (selectedSuggestionIndex > 0) {
                            selectedSuggestionIndex--;
                            highlightSuggestion(selectedSuggestionIndex);
                            suggestionItems[selectedSuggestionIndex].scrollIntoView({
                                block: 'nearest'
                            });
                        }
                    } else if (event.key === 'Enter') {
                        if (selectedSuggestionIndex >= 0 && selectedSuggestionIndex < suggestionItems
                            .length) {
                            const selectedWord = filteredWords[selectedSuggestionIndex];
                            searchInput.value = selectedWord.Word;
                            showWordDetails(selectedWord);
                        }
                    }
                }
            });

            searchInput.addEventListener('search', () => {
                const query = searchInput.value.toLowerCase();

                const foundEntry = currentData.find(entry =>
                    entry.Word.toLowerCase() === query
                );

                if (foundEntry) {
                    showWordDetails(foundEntry);
                    suggestions.style.display = 'none';
                }
            });

            languageSelector.addEventListener('change', (event) => {
                const selectedLanguage = event.target.value;
                const url = selectedLanguage === 'latin' ? latinJsonURL : cyrillicJsonURL;
                loadDictionary(url, loadWordFromURL);
            });

            loadDictionary(cyrillicJsonURL, loadWordFromURL);
        });

        document.addEventListener('DOMContentLoaded', function () {
            var navSelect = document.getElementById('nav-select');

            navSelect.addEventListener('change', function () {
                window.location.href = this.value;
            });
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            function setRealHeight() {
                const realHeight = window.innerHeight;
                document.body.style.height = realHeight + 'px';
            }

            setRealHeight();

            document.body.style.display = 'flex';
            document.body.style.flexDirection = 'column';
            document.body.style.overflow = 'hidden';

            const main = document.querySelector('main');
            if (main) {
                main.style.flex = '1';
                main.style.overflowY = 'auto';
            }

            window.addEventListener('resize', setRealHeight);
            window.addEventListener('orientationchange', setRealHeight);
        });
    </script>

</body>

</html>

<script>
    if (!/Mobi|Android/i.test(navigator.userAgent)) {
        const currentParams = window.location.search;
        const desktopPage = 'explanatory-dictionary.html';
        window.location.href = desktopPage + currentParams;
    }
</script>