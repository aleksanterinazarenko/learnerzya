<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Erzya Wikipedia</title>
    <link rel="stylesheet" href="style-mobile.css">
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <select id="nav-select" class="nav-select">
        <option value="index-mobile.html">Main Page</option>
        <option value="english-erzya-dictionary-mobile.html">English-Erzya dictionary</option>
        <option value="erzya-english-dictionary-mobile.html">Erzya-English dictionary</option>
        <option value="finnish-erzya-dictionary-mobile.html">Finnish-Erzya dictionary</option>
        <option value="grammar-mobile.html">Grammar</option>
        <option value="transliteration-tool-mobile.html">Transliteration tool</option>
        <option value="about-the-spelling-mobile.html">About the spelling</option>
        <option value="sources-mobile.html">Sources</option>
    </select>
</header>

    <main>
      <a href="/learnerzya/index-mobile.html" style="color: #333; text-decoration: none;"><h1>Learn Erzya</h1></a>

      <div class="container">
        <select id="languageSelector">
            <option value="latin">Latin</option>
            <option value="cyrillic">Cyrillic</option>
        </select>
        <input id="searchInput" placeholder="Search for a word ..." type="text" autocomplete="off" />
        <div id="suggestions" class="suggestions-list" style="display: none;"></div>

    <div id="wordDetails" class="word-details"></div>
</div>

</main>
    </main>

    <style>
      .nav-select {
      width: 100%;
      padding: 10px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      font-size: 16px;
      font-weight: bold;
      border: none;
      background-color: #333;
      color: #fff;
      cursor: pointer;
  }
  
  .nav-select option {
      padding: 10px;
      background-color: #333;
      color: #fff;
  }

      .suggestions-list {
          border-top: none;
          padding: 0 20px;
          overflow-y: auto;
          background-color: #fff;
      }

      .suggestion-item {
          padding: 10px;
          cursor: pointer;
      }

      .suggestion-item.highlight {
          background-color: #f0f0f0;
      }

      .word-details {
          text-align: left;
          font-size: 16px;
          padding: 0 20px;
      }

      .entry {
    color: #333;
    font-family: 'Calibri', sans-serif;
    font-size: 16px;
    font-style: normal;
    line-height: 1.5;
    padding: 10px 20px;
    margin: 0;
    text-align: left;
    }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const latinJsonURL = 'https://raw.githubusercontent.com/aleksanterinazarenko/databases/refs/heads/main/wikipedia-myv-lat.json';
            const cyrillicJsonURL = 'https://raw.githubusercontent.com/aleksanterinazarenko/databases/refs/heads/main/wikipedia-myv-cyr.json';

            const searchInput = document.getElementById('searchInput');
            const languageSelector = document.getElementById('languageSelector');
            const suggestions = document.getElementById('suggestions');
            const wordDetails = document.getElementById('wordDetails');

            let currentData = [];
            let selectedSuggestionIndex = -1;
            let filteredWords = [];
            let isMouseOverSuggestion = false;

            function showWordDetails(entry) {
                wordDetails.innerHTML = `<h2 style="color: #B22222; margin-bottom: 30px; padding: 0 20px;">${entry.Word}</h2><p>${entry.Definition}</p>`;
            }

            function loadDictionary(url) {
                fetch(url)
                    .then(response => {
                        if (!response.ok) throw new Error('Network response was not ok');
                        return response.json();
                    })
                    .then(data => {
                        currentData = [];
                        let lastEntry = null;

                        data.forEach(entry => {
                            if (entry.Word) {
                                if (lastEntry && lastEntry.Definition) currentData.push(lastEntry);
                                lastEntry = { Word: entry.Word, Definition: entry.Definition };
                            } else if (lastEntry && entry.Definition) {
                                lastEntry.Definition += `<div class="entry">${entry.Definition}</div>`;
                            }
                        });
                        if (lastEntry) currentData.push(lastEntry);
                        suggestions.innerHTML = '';
                    })
                    .catch(error => console.error('Error loading the dictionary:', error));
            }

            function highlightSuggestion(index) {
                const suggestionItems = Array.from(suggestions.getElementsByClassName('suggestion-item'));
                suggestionItems.forEach((item, idx) => {
                    item.classList.toggle('highlight', idx === index);
                });
            }

            searchInput.addEventListener('input', (event) => {
                const query = event.target.value.toLowerCase().trim();
                suggestions.innerHTML = '';
                selectedSuggestionIndex = -1;

                if (query === "") {
                    wordDetails.innerHTML = '';
                    suggestions.style.display = 'none';
                } else {
                    filteredWords = currentData
                        .filter(entry => entry.Word.toLowerCase().includes(query))
                        .sort((a, b) => {
                            const aStartsWith = a.Word.toLowerCase().startsWith(query);
                            const bStartsWith = b.Word.toLowerCase().startsWith(query);
                            if (aStartsWith && !bStartsWith) return -1;
                            if (!aStartsWith && bStartsWith) return 1;
                            return a.Word.length - b.Word.length;
                        });

                    if (filteredWords.length > 0) {
                        filteredWords.forEach((entry, index) => {
                            const suggestionItem = document.createElement('div');
                            suggestionItem.className = 'suggestion-item';
                            suggestionItem.textContent = entry.Word;

                            suggestionItem.onclick = () => {
                                selectedSuggestionIndex = index;
                                highlightSuggestion(selectedSuggestionIndex);
                                searchInput.value = entry.Word;
                                showWordDetails(entry);
                                suggestions.style.display = 'none';
                            };

                            suggestionItem.onmouseover = () => {
                                isMouseOverSuggestion = true;
                                selectedSuggestionIndex = index; 
                                highlightSuggestion(selectedSuggestionIndex);
                            };

                            suggestionItem.onmouseout = () => {
                                isMouseOverSuggestion = false;
                            };

                            suggestions.appendChild(suggestionItem);
                        });
                        suggestions.style.display = 'block';
                    } else {
                        suggestions.style.display = 'none';
                    }
                }
            });

            searchInput.addEventListener('keydown', (event) => {
                const suggestionItems = Array.from(suggestions.getElementsByClassName('suggestion-item'));

                if (!isMouseOverSuggestion) {
                    if (event.key === 'ArrowDown') {
                        if (selectedSuggestionIndex < suggestionItems.length - 1) {
                            selectedSuggestionIndex++;
                            highlightSuggestion(selectedSuggestionIndex);
                            suggestionItems[selectedSuggestionIndex].scrollIntoView({ block: 'nearest' });
                        }
                    } else if (event.key === 'ArrowUp') {
                        if (selectedSuggestionIndex > 0) {
                            selectedSuggestionIndex--;
                            highlightSuggestion(selectedSuggestionIndex);
                            suggestionItems[selectedSuggestionIndex].scrollIntoView({ block: 'nearest' });
                        }
                    } else if (event.key === 'Enter') {
                        if (selectedSuggestionIndex >= 0 && selectedSuggestionIndex < suggestionItems.length) {
                            const selectedWord = filteredWords[selectedSuggestionIndex];
                            searchInput.value = selectedWord.Word;
                            showWordDetails(selectedWord);
                            suggestions.style.display = 'none';
                        }
                    }
                }
            });

            languageSelector.addEventListener('change', (event) => {
                const selectedLanguage = event.target.value;
                const url = selectedLanguage === 'cyrillic' ? cyrillicJsonURL : latinJsonURL;
                loadDictionary(url);
            });

            loadDictionary(latinJsonURL);
        });
    </script>

</body>
</html>
